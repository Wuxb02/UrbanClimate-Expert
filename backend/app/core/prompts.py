"""
提示词统一管理模块

集中管理系统中所有 LLM 提示词，便于维护和调优。

使用方法:
    from app.core.prompts import (
        DOCUMENT_SUMMARY_PROMPT,
        RAG_QUERY_PROMPT,
        RAG_STREAM_QUERY_PROMPT,
    )
"""

# =============================================================================
# 文档摘要生成提示词
# =============================================================================

DOCUMENT_SUMMARY_PROMPT = """
# 角色
你是一位拥资深城市气候领域专家。

# 任务
请阅读附后的【论文文本】，撰写一份精炼的微型摘要。

# Constraints
1. **字数限制**：严格控制在 200 中文字符以内。
2. **结构要求**：摘要必须包含且仅包含以下三个要素，自然融合，不要使用列表形式：
   - **背景 (Background)**：简述研究解决的核心问题或痛点。
   - **方法 (Methods)**：明确提及使用了什么模型、算法（如LSTM, GNN等）、数据或实验设计。
   - **结论 (Conclusion)**：量化的主要结果或核心贡献。
3. **语气**：客观、专业、学术化。

输入文本：
{content}
总结：
"""

# 摘要生成配置
SUMMARY_MAX_INPUT_LENGTH = 8000  # 摘要输入文本最大长度
SUMMARY_MAX_OUTPUT_LENGTH = 500  # 摘要输出文本最大长度


# =============================================================================
# RAG 查询提示词
# =============================================================================

RAG_QUERY_SYSTEM_PROMPT = """你是一个专业的城市气候领域研究助手。
请基于提供的上下文信息，准确、专业地回答用户问题。
如果上下文信息不足以回答问题，请诚实说明。"""

RAG_QUERY_PROMPT = """【重要指令】请完全基于检索到的上下文（Context）来回答用户的问题。
即使上下文中包含你不知道的概念，也要根据上下文中的描述进行解释。
不要使用你的预训练知识，不要提及你的知识截止日期。

用户问题：{question}"""

RAG_STREAM_QUERY_PROMPT = """【重要指令】请完全基于检索到的上下文（Context）来回答用户的问题。
即使上下文中包含你不知道的概念，也要根据上下文中的描述进行解释。
不要提及你的知识截止日期。

用户问题：{question}"""


# =============================================================================
# 知识图谱相关提示词 (预留)
# =============================================================================

ENTITY_EXTRACTION_PROMPT = """请从以下文本中提取关键实体（人物、地点、组织、概念等）。
以 JSON 数组格式返回，每个实体包含 name（名称）和 type（类型）字段。

文本：
{text}

实体列表："""

RELATIONSHIP_EXTRACTION_PROMPT = """请从以下文本中提取实体之间的关系。
以 JSON 数组格式返回，每个关系包含 source（源实体）、target（目标实体）和 relation（关系类型）字段。

文本：
{text}

已识别的实体：
{entities}

关系列表："""


# =============================================================================
# 对话相关提示词 (预留)
# =============================================================================

CHAT_SYSTEM_PROMPT = """你是 UrbanClimate-Expert，一个专业的城市气候领域科研助手。

你的职责是：
1. 解答用户关于城市气候的专业问题
2. 基于知识库中的文献资料提供准确信息
3. 提供文献引用和来源追溯

请保持专业、准确、友好的回答风格。"""

CHAT_WELCOME_MESSAGE = """欢迎使用城市气候专家系统！

我可以帮助您：
- 解答城市气候相关的学术问题
- 检索和分析上传的文献资料
- 探索知识图谱中的概念关联

请问有什么可以帮助您的？"""


# =============================================================================
# 工具函数
# =============================================================================

def format_prompt(template: str, **kwargs) -> str:
    """
    格式化提示词模板

    Args:
        template: 包含 {placeholder} 的模板字符串
        **kwargs: 用于替换占位符的键值对

    Returns:
        格式化后的字符串

    Example:
        >>> format_prompt(DOCUMENT_SUMMARY_PROMPT, content="文档内容...")
    """
    return template.format(**kwargs)


def truncate_text(text: str, max_length: int, suffix: str = "...") -> str:
    """
    截断文本到指定长度

    Args:
        text: 原始文本
        max_length: 最大长度
        suffix: 截断后的后缀

    Returns:
        截断后的文本
    """
    if len(text) <= max_length:
        return text
    return text[:max_length - len(suffix)] + suffix


# =============================================================================
# 提示词版本信息
# =============================================================================

PROMPTS_VERSION = "1.0.0"
PROMPTS_LAST_UPDATED = "2025-12-19"
